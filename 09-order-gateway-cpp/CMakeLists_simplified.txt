cmake_minimum_required(VERSION 3.15)
project(OrderGatewaySimplified CXX)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# Include directories
include_directories(${CMAKE_SOURCE_DIR}/include)

# Source files
set(SOURCES
    src/main_simplified.cpp
    src/uart_reader.cpp
    src/bbo_parser.cpp
    src/tcp_server.cpp
    src/csv_logger.cpp
)

# Executable
add_executable(order_gateway ${SOURCES})

# Platform-specific libraries
if(WIN32)
    # Windows: Link against Winsock2
    target_link_libraries(order_gateway ws2_32)
else()
    # Linux: Link against pthread
    target_link_libraries(order_gateway pthread)
endif()

# Optional: Link Boost.Asio if available
# find_package(Boost COMPONENTS system)
# if(Boost_FOUND)
#     target_link_libraries(order_gateway Boost::system)
#     target_compile_definitions(order_gateway PRIVATE USE_BOOST_ASIO)
# endif()

# Installation
install(TARGETS order_gateway DESTINATION bin)

# Print build information
message(STATUS "Build configuration:")
message(STATUS "  CMAKE_SYSTEM_NAME: ${CMAKE_SYSTEM_NAME}")
message(STATUS "  CMAKE_CXX_COMPILER: ${CMAKE_CXX_COMPILER}")
message(STATUS "  CMAKE_CXX_STANDARD: ${CMAKE_CXX_STANDARD}")

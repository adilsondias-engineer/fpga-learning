# Arty A7-100 Ethernet PHY Specifications

**SOURCE:** Official Arty A7 Reference Manual (Arty_A7_Reference_Manual.docx)

## Critical Facts (Read This First!)

### PHY Chip

- **Part Number:** Texas Instruments DP83848J
- **Interface:** MII (Media Independent Interface) - **NOT RGMII!**
- **Speed:** 10/100 Mbps ONLY - **NO Gigabit support!**
- **PHY Address:** 00001

### Power-On Defaults

- MII mode interface (confirmed)
- Auto-negotiation enabled
- Advertises all 10/100 modes capable
- LED Mode 2

## Critical Clock Requirements

### Reference Clock (FPGA → PHY)

- **FPGA MUST generate 25 MHz clock** for PHY X1 pin
- Signal name: `ETH_REF_CLK`
- This clock is **required** for PHY operation
- Generated from 100 MHz system clock using MMCM/PLL

### Data Clocks (PHY → FPGA)

- `eth_rx_clk` - 25 MHz (for 100 Mbps) or 2.5 MHz (for 10 Mbps)
- `eth_tx_clk` - 25 MHz (for 100 Mbps) or 2.5 MHz (for 10 Mbps)
- **PHY provides these clocks TO the FPGA, not the other way around!**

## MII Signal Overview

### From FPGA to PHY (Outputs)

| Signal       | Width | Description                          |
| ------------ | ----- | ------------------------------------ |
| eth_ref_clk  | 1     | 25 MHz reference clock (REQUIRED!)   |
| eth_rstn     | 1     | Reset (active low)                   |
| eth_txd[3:0] | 4     | Transmit data                        |
| eth_tx_en    | 1     | Transmit enable                      |
| eth_mdc      | 1     | MDIO management clock                |
| eth_mdio     | 1     | MDIO management data (bidirectional) |

### From PHY to FPGA (Inputs)

| Signal       | Width | Description                         |
| ------------ | ----- | ----------------------------------- |
| eth_rx_clk   | 1     | Receive clock (25 MHz @ 100Mbps)    |
| eth_tx_clk   | 1     | Transmit clock (25 MHz @ 100Mbps)   |
| eth_rxd[3:0] | 4     | Receive data                        |
| eth_rx_dv    | 1     | Receive data valid                  |
| eth_rx_er    | 1     | Receive error (optional)            |
| eth_col      | 1     | Collision detect (half-duplex only) |
| eth_crs      | 1     | Carrier sense                       |

## Pin Assignments (Arty A7-35/100)

Reference: https://github.com/Digilent/digilent-xdc/blob/master/Arty-A7-35-Master.xdc

```tcl
## Ethernet PHY
set_property -dict { PACKAGE_PIN D17   IOSTANDARD LVCMOS33 } [get_ports { eth_col }]
set_property -dict { PACKAGE_PIN G14   IOSTANDARD LVCMOS33 } [get_ports { eth_crs }]
set_property -dict { PACKAGE_PIN F16   IOSTANDARD LVCMOS33 } [get_ports { eth_mdc }]
set_property -dict { PACKAGE_PIN K13   IOSTANDARD LVCMOS33 } [get_ports { eth_mdio }]
set_property -dict { PACKAGE_PIN G18   IOSTANDARD LVCMOS33 } [get_ports { eth_ref_clk }]
set_property -dict { PACKAGE_PIN C16   IOSTANDARD LVCMOS33 } [get_ports { eth_rstn }]
set_property -dict { PACKAGE_PIN F15   IOSTANDARD LVCMOS33 } [get_ports { eth_rx_clk }]
set_property -dict { PACKAGE_PIN G16   IOSTANDARD LVCMOS33 } [get_ports { eth_rx_dv }]
set_property -dict { PACKAGE_PIN D18   IOSTANDARD LVCMOS33 } [get_ports { eth_rxd[0] }]
set_property -dict { PACKAGE_PIN E17   IOSTANDARD LVCMOS33 } [get_ports { eth_rxd[1] }]
set_property -dict { PACKAGE_PIN E18   IOSTANDARD LVCMOS33 } [get_ports { eth_rxd[2] }]
set_property -dict { PACKAGE_PIN G17   IOSTANDARD LVCMOS33 } [get_ports { eth_rxd[3] }]
set_property -dict { PACKAGE_PIN C17   IOSTANDARD LVCMOS33 } [get_ports { eth_rxer }]
set_property -dict { PACKAGE_PIN H16   IOSTANDARD LVCMOS33 } [get_ports { eth_tx_clk }]
set_property -dict { PACKAGE_PIN H15   IOSTANDARD LVCMOS33 } [get_ports { eth_tx_en }]
set_property -dict { PACKAGE_PIN H14   IOSTANDARD LVCMOS33 } [get_ports { eth_txd[0] }]
set_property -dict { PACKAGE_PIN J14   IOSTANDARD LVCMOS33 } [get_ports { eth_txd[1] }]
set_property -dict { PACKAGE_PIN J13   IOSTANDARD LVCMOS33 } [get_ports { eth_txd[2] }]
set_property -dict { PACKAGE_PIN H17   IOSTANDARD LVCMOS33 } [get_ports { eth_txd[3] }]
```

## Timing Constraints

```tcl
## Reference clock (generated by FPGA)
create_generated_clock -name eth_ref_clk \
    -source [get_pins your_pll/CLKOUT0] \
    -divide_by 1 \
    [get_ports eth_ref_clk]

## RX Clock (provided by PHY)
create_clock -period 40.000 -name eth_rx_clk [get_ports eth_rx_clk]

## TX Clock (provided by PHY)
create_clock -period 40.000 -name eth_tx_clk [get_ports eth_tx_clk]

## Input delays for RX data
set_input_delay -clock eth_rx_clk -max 10.0 [get_ports {eth_rxd[*] eth_rx_dv}]
set_input_delay -clock eth_rx_clk -min 0.0 [get_ports {eth_rxd[*] eth_rx_dv}]

## Output delays for TX data
set_output_delay -clock eth_tx_clk -max 10.0 [get_ports {eth_txd[*] eth_tx_en}]
set_output_delay -clock eth_tx_clk -min 0.0 [get_ports {eth_txd[*] eth_tx_en}]
```

## Clock Generation (100 MHz → 25 MHz)

Use MMCME2_BASE or PLLE2_BASE:

```vhdl
clocking : PLLE2_BASE
    generic map (
        BANDWIDTH        => "OPTIMIZED",
        CLKFBOUT_MULT    => 8,         -- 100 MHz × 8 = 800 MHz (VCO)
        CLKOUT0_DIVIDE   => 32,        -- 800 MHz ÷ 32 = 25 MHz
        CLKIN1_PERIOD    => 10.0,      -- 100 MHz input
        DIVCLK_DIVIDE    => 1,
        STARTUP_WAIT     => FALSE
    )
    port map (
        CLKIN1   => CLK100MHz,
        CLKOUT0  => eth_ref_clk_unbuf,
        LOCKED   => pll_locked,
        PWRDWN   => '0',
        RST      => '0',
        CLKFBOUT => clkfb,
        CLKFBIN  => clkfb
    );
```

## Recommended IP Cores (Xilinx)

Per the manual, these IP cores support this PHY:

1. AXI EthernetLite IP core (simplest)
2. AXI 1G/2.5G Ethernet Subsystem IP core
3. Tri Mode Ethernet MAC IP core

## Key Differences: MII vs RGMII

| Feature      | MII (Arty A7)       | RGMII (Your Code) |
| ------------ | ------------------- | ----------------- |
| Speed        | 10/100 Mbps         | 1000 Mbps         |
| Data width   | 4-bit               | 4-bit             |
| Data rate    | SDR (Single)        | DDR (Double)      |
| Clock freq   | 25 MHz / 2.5 MHz    | 125 MHz           |
| Clock source | PHY → FPGA          | FPGA → PHY        |
| Reference    | FPGA → PHY (25 MHz) | None              |
| Total pins   | ~18                 | ~12               |

## Reset Timing

- **Minimum reset pulse:** 10 ms (per manual)
- **Recommended:** 20 ms minimum
- PHY reset is **active LOW**

## LEDs in RJ45 Connector

- Two LEDs provide link/activity status
- Controlled by PHY, not FPGA
- **Normal:** One LED on, one LED off (even when idle)

## Additional Resources

- DP83848J Datasheet: Available from Texas Instruments
- Arty A7 Resource Center: https://digilent.com/reference/programmable-logic/arty-a7/start
- XDC Master File: https://github.com/Digilent/digilent-xdc
- Getting Started Tutorial: Arty A7 Resource Center (Microblaze Servers)

## Lesson Learned

**ALWAYS check the official hardware documentation FIRST before writing any code!**

The 4+ hours spent implementing RGMII could have been avoided by reading the manual which clearly states:

> "The TI PHY uses the MII interface and supports 10/100 Mb/s."
